<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Google Login + HubSpot Integration</title>
    <script src="https://accounts.google.com/gsi/client" async defer></script>
    <script>
        // Function to handle the Google login callback and send user data to Netlify function
        function handleGoogleLoginResponse(response) {
            // Get user information from Google
            const { email, given_name: firstname, family_name: lastname } = response;

            // Call Netlify function to sync data with HubSpot
            fetch('/.netlify/functions/sync-hubspot', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    email,
                    firstname,
                    lastname,
                }),
            })
            .then(response => response.json())
            .then(result => {
                if (result.success) {
                    alert('Successfully synced with HubSpot!');
                    console.log(result);
                } else {
                    alert('Error syncing with HubSpot!');
                    console.error(result.error);
                }
            })
            .catch(error => {
                alert('Failed to sync with HubSpot');
                console.error(error);
            });
        }

        // Initialize the Google login client after the page has loaded
        window.onload = () => {
            google.accounts.id.initialize({
                client_id: 'YOUR_GOOGLE_CLIENT_ID',
                callback: handleGoogleLoginResponse,
            });

            google.accounts.id.renderButton(
                document.getElementById('google-signin-button'),
                { theme: 'outline', size: 'large' }
            );
        };
    </script>
</head>
<body>
    <h1>Google Login + HubSpot Integration</h1>
    
    <!-- Google login button -->
    <div id="google-signin-button"></div>
</body>
</html>
